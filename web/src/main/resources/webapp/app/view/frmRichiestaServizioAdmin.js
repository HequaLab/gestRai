/*
 * File: app/view/frmRichiestaServizioAdmin.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Rai.view.frmRichiestaServizioAdmin', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.frmRichiestaServizioAdmin',

    requires: [
        'Rai.view.frmRichiestaNuovoServizioViewModel1',
        'Rai.view.frmRichiestaNuovoServizioViewController1',
        'Ext.grid.Panel',
        'Ext.grid.column.Number',
        'Ext.grid.column.Date',
        'Ext.grid.column.Action',
        'Ext.view.Table',
        'Ext.toolbar.Paging',
        'Ext.grid.plugin.CellEditing',
        'Ext.grid.feature.Grouping',
        'Ext.XTemplate',
        'Ext.form.field.Date',
        'Ext.form.field.Time',
        'Ext.form.field.TextArea',
        'Ext.button.Button'
    ],

    controller: 'frmrichiestaservizioadmin',
    viewModel: {
        type: 'frmrichiestaservizioadmin'
    },
    height: 753,
    id: 'frmRichiestaServizioAdmin',
    padding: 0,
    width: 1278,
    title: 'Area servizi',
    defaultListenerScope: true,

    layout: {
        type: 'border',
        padding: 2
    },
    items: [
        {
            xtype: 'panel',
            region: 'center',
            padding: 0,
            layout: 'fit',
            bodyBorder: true,
            bodyPadding: 2,
            title: '',
            items: [
                {
                    xtype: 'gridpanel',
                    padding: 5,
                    bodyBorder: true,
                    title: 'Elenco servizi',
                    store: 'storeRichiesteServizi',
                    columns: [
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'nome',
                            text: 'Servizio',
                            flex: 0.8
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'fornitore',
                            text: 'Fornitore',
                            flex: 0.8,
                            editor: {
                                xtype: 'combobox',
                                displayField: 'ragioneSociale',
                                store: 'storeFornitori',
                                valueField: 'ragioneSociale'
                            }
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'lotto',
                            text: 'Lotto',
                            flex: 0.8
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'produzione',
                            text: 'Produzione',
                            flex: 0.8
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'matricola',
                            text: 'Matricola',
                            flex: 0.8
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'luogo',
                            text: 'Luogo',
                            flex: 0.8
                        },
                        {
                            xtype: 'numbercolumn',
                            dataIndex: 'ore',
                            text: 'Ore',
                            flex: 0.4
                        },
                        {
                            xtype: 'datecolumn',
                            dataIndex: 'data',
                            text: 'Data',
                            flex: 0.7,
                            format: 'd/M/ddd'
                        },
                        {
                            xtype: 'datecolumn',
                            dataIndex: 'dataFine',
                            text: 'Data fine',
                            flex: 0.7
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'ora',
                            text: 'Ora',
                            flex: 0.5
                        },
                        {
                            xtype: 'gridcolumn',
                            renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {


                                if (value === "Approvato"){
                                    return '<span style="color:' + "#73b51e" + ';">' + "<b>"  + value + "</b>"+ '</span>';
                                }
                                else if ( value === "Non approvato"){
                                    return '<span style="color:' + "#cf4c35" + ';">' + value + '</span>';
                                }
                                else if ( value === "Erogato"){
                                    return '<span style="color:' + "#0277BD" + ';"><b>' + value + '</b></span>';
                                }
                                else if ( value === "In lavorazione"){
                                    return '<span style="color:' + "#AFB42B" + ';"><b>' + value + '</b></span>';
                                }
                                else if ( value === "Nessuno"){
                                    return '<span style="color:' + "#795548" + ';"><b>' + value + '</b></span>';
                                }


                                else return value;
                            },
                            dataIndex: 'stato',
                            groupable: false,
                            text: 'Stato',
                            flex: 0.7
                        },
                        {
                            xtype: 'actioncolumn',
                            id: 'inLavorazioneSubmit',
                            align: 'center',
                            dataIndex: 'stato',
                            text: 'Azioni',
                            flex: 0.5,
                            items: [
                                {
                                    handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                        var s = record.get('stato');
                                        if ( s === 'Nessuno' || s === 'Non approvato'){
                                            Ext.Msg.show({
                                                title:'Operazione non permessa',
                                                msg: "La richiesta non è stata approvata, non è presente nessuno report",
                                                buttons: Ext.Msg.Ok,
                                            });
                                            return;
                                        }

                                        var stato = 'approvato';
                                        if (record.get('stato') == 'Erogato')stato = 'erogato';
                                        var nomeReport = 'report_' + record.get('richiestaNuovoServizioId') + "_" + stato + '.pdf';


                                        var win = Ext.create('Ext.window.Window', {
                                            height: 634,
                                            width: 780,
                                            layout: 'border',
                                            title: 'Report servizio',
                                            titleAlign: 'center',
                                            maximizable: true,
                                            closeAction: 'hide',
                                            items: [{
                                                xtype: 'component',
                                                html : '<iframe src="../files/'+ nomeReport + '" width="100%" height="100%"></iframe>',
                                            }]
                                        });
                                        win.show();
                                    },
                                    icon: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAGP0lEQVR4Xu1bS3biVhC9JeOkPYozSBpGoTcQoxUEr8B4BW2voDvDNM4JfQLJ0HgFISsIXkG7VyA5G2h7BCcZND3COXwqp54+fgiBHiBA+DRD+0l67+pW1a2PCAa/bxpOKQf6A0DJYPlaljDQ6lZL52nfnExuWKi7H0E4NFm7zjUMftut2rU0n5EIQP5Xp0wWvZOHMvOfINyluYHEezHOiOi7YB2Dz7tVu5V4neGCxQAY83H3Z/vG8N6pLMs3nBsC/aDfjFPcx04CAEZvSHz8b9V2V0V5NwFQ9ohef8gvejW7twoIuwuAd2q3P+DjVUDYdQDAjJvuRel4WRasBYDDmnP4LGedwKK77pvv3y+7ObkuzglG77eKRkgdACWamN5puqHdqZZOlwXBBADPJSynEVIHIN9wPxBQFM1AohyJjlaJ3aYA+CAsrBFSB6DQcBnMt50Lu/Ttb05lj+kvAaN7YZ8tw4JFAFAgLKgRUgcgX3fuRLmxxS8e/kPvYJ8+Mvh9t2qXNwHAohohfQAaTo1AvwTeWRixUQAW1AipAyAR4CCHG8/20SLgbOMA+BqhUy3ZSaxLHQAVun53ihjDJdBXvnNa3gTqTouIXiYdJO7/Jv5gLQDIZiQc7gGSyAgIrsnbiDuE0hT7eG0MAKMYALZVAHwRo/yBx4L1FDSiwEyk7wYRYW0MkI0V6k4bRCcM/uQzod0f8Pkq2j2JCZkCIBBF/QF/HTjGNBKYeSBkBgBxhDSmD4Eo0qODgMAWn3Z/slOvLmUHgIZzRqqQyledqq2cmJckoamcVIpFDZ0R2QHAD18j4tN/3tjtiU1qoW2VPCHOFLIDgJ8Uif3HOb18yBCJEFTrVo/eJjk4k/9nAoCo/c/auCRLFotaVFohlQiRDQBi7H8WCF79AC1fOt+NwKerFDuzAcAc+5+l9g5yCoQTcY5johoRTVd8aXSfFDmyAcAc+1eR4Iu9I2YuWYwig1W7jQiLpsttHvNVtE+xdQDi7P95/e8TC1wGsRxyZn9RFKNoBFkTJlLM99FulN4oiZbCtg+Ab/9SD5CNE6Oi9xWVLGbcMMEdE1xrhF70LfqiyTMJlUdMRwndgUrxJTCN7QMQl74yXzOhPQLcRRxcoe68ZoIkVCqjHILP9esLDacJ0Cs969saAD71LwFU1Ftjvieg2R+itUry46fVzYD2woaHwfhKnvFsnxxVgN02A5SoYboMqe4XRU2Ei+maCBseL2O+7lzYCnSVguvd7E2kw88bt68scFM9nflW4rmu/00PaLJOVZpGqIFQJMahmNXDAE2dYRsFILRB8d5jVMgiMYHSEGwvYusmhzddszEAgnAnXn0ElIlQVD2AFUrgpofMRD3gEWm+GgKtoB1mUodL46Cz7rE5BgTOhtF7jPOPuf86D5kJBsgmQh/gh7zOhe05wy3+NsaALZ5x7qM/A7BpHZA1JqyXAUALoNQruemCyEXpRypdlrYSTHej67/bZwDWxQBRe/77i06NluE1J8PR1uA9B9eQNEWAx9k+RlFp+8g0qM4PrVAylzbLTJQu1BsMnt6pluZeJ9khAElhVXtcfknX+F3gChhSD5wA0FReq/Ec7bc2E0g6jOwh0h5PBCDY90T3yP9jpgEQNcgsKTAwtvhK7wIFSjHKAMUQ9oYeCOQyj6+jZbFC3XG91FqNwE0MWHgMs6bMjMATo/QbYUB0iktPhfWYrLMm788RRex84luAiXg+DcDUBHmcc9gKAGD+McgJFgEgLm6HE2e7BIBenwvmBGNMIJwcmWBBZJ4w7xdYY0wgOwxQPkDq+IweM5q6LQcHMAZg+k17I3cGRRadbWHoXZcOMI0COZATFwbjfMAMZ7d7AEgY+3LfemkxS/Ey/NAqyQkqoCIVXm3GaCIKqBBLe6HG8C7lUlicDcLnJhgwEZKYy96A9PQXZiYARIclwsHrXXKCs7RqIgDMt/0hykGJ2/9WUZlQpp2g6TT3PADkgA8DVCbq+3X3XdAxfnoASINjiKJiSw530Z6/dIFAqsfguYanZgKzzMRLiOgyKGg8KQBmdYuUR2frSGYHogfPLACz3mDW/p5KLiCHyjecnp7bZ+2gsYkQ+FO3aid+8J1YEJGb65Ncu3B46VIPCWcmDdr/AVTvipsjYS5YAAAAAElFTkSuQmCC',
                                    tooltip: 'Visualizza report PDF'
                                },
                                {
                                    handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                        if (record.get('stato') === "Non approvato"){
                                            Ext.Msg.show({
                                                title:'Operazione non permessa',
                                                msg: "La richiesta non è stata approvata: non può essere erogata.",
                                                buttons: Ext.Msg.Ok,
                                            });
                                            return;
                                        }
                                        else if (record.get('stato') === "Cancellato"){
                                            Ext.Msg.show({
                                                title:'Operazione non permessa',
                                                msg: "La richiesta è stata cancellata: non può essere erogata.",
                                                buttons: Ext.Msg.Ok,
                                            });
                                            return;
                                        }
                                        else if (record.get('stato') === "In lavorazione"){
                                            Ext.Msg.show({
                                                title:'Operazione non permessa',
                                                msg: "La richiesta è in lavorazione, non sono permesse modifiche",
                                                buttons: Ext.Msg.Ok,
                                            });
                                            return;
                                        }
                                        else if (record.get('stato') === "Erogato"){
                                            Ext.Msg.show({
                                                title:'Operazione non permessa',
                                                msg: "Il servizio è stato erogato, non sono permesse modifiche",
                                                buttons: Ext.Msg.Ok,
                                            });
                                            return;
                                        }

                                        record.set('stato',"In lavorazione");
                                    },
                                    icon: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADJUlEQVRYR+1XQVITURB9PZgqWREXWmElnIDMCSA7d8ABLOPCNbC0BopQGlkS1i6IR7A8gOEEE05gXGUsF8QVSGCe1TPzk5/JBCZqdEOqKKqSnv9fv379ukcwg0+x5hcfFuRIiA0IiiRaIA+CPbeVvk5mcD9Kdb8lkNWRs4ke5+gGr92O/X0mgMd1v6xB3z23/TsAF+ttZj1H8GXguc1bAZTe+k0ReaFBIWRbgCIYLge7bjUPGKV/viDnEwAcBJ5bmwig9MZfgwP9a+IGNQVC8PSyj41eze3lAaAxpbrfE8hCOp4hK2kdzEoDNYHsj2qAZ91dNyrtGANZtGnmgeeu5c06HadsEnwmjlwyxM9ve+5h1lkRAxosjny2A/4EQFxKORGiCPAUkFWKNAJv5SCTgWwA6AReeXlaBhbrfgOQLYI/hKhRFATWkrZsX/RZsfU0kQG9uOuVp9KI3UEkP0DQCgU9hygLnQVK6ILCYLdcMYn9NQAm8wFj5MeLa1RNtqbDVJy2H8QA6n5VICdpuvMyoMb1AOLr8wn1armt7q7bMGcmALQ7VolheQ2A8bZJleDJO3/j6gotu34KXJ2tVPcHzxNoqnkx5LHd81FMNBtkJQKaeMKtAGzjSC5Zp8NN4+dquXqhKj2LQZA7yoLJHkTHuCzA467nqtNGJchkIAPAPojetbCic2Lo+TyOqZatlPnEAOp+DUQVgqb+F5Gnps2nBxAXukfhzkjWlMb5xU3j0bxsQuQIQBvkVwraQpQhsk7wAMSSYUE1FgOwBtCIGVnePYml0YzR61/fPC8U5j6Z7yNNmL1AAShPiU3T4bJhYHx+xydokeMhJFgSYOkuYwpv+MqZk/dZcREDOuhCRGP+sh+dGWlgEoC77hv7XXWTtvUBGwmjOntMN/0XADbqmQNQtZv1bOI+MGmBmJr/xGDsEuQCMLLDkWckthPhac9G61neT1oDUwOw94BcrZdCdg9gagbsURq77HAX/CclKB36Swhh7/wd8/IwWNPzKlDjHDQllC9DK87RhtOcnyfW7qpcXZDn0Gli7gFYq7mOX30b1t2wnfWi8wvFRFU8abj8MgAAAABJRU5ErkJggg==',
                                    tooltip: 'Imposta la richiesta in lavorazione'
                                },
                                {
                                    handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                        var uploadWidg = Ext.widget('uploadWin');
                                        uploadWidg.idRichiesta = record.get('richiestaNuovoServizioId');
                                        uploadWidg.show();

                                        if (record.get('stato') === "Non approvato"){
                                            Ext.Msg.show({
                                                title:'Operazione non permessa',
                                                msg: "La richiesta non è stata approvata: non può essere erogata.",
                                                buttons: Ext.Msg.Ok,
                                            });
                                            return;
                                        }
                                        else if (record.get('stato') === "Cancellato"){
                                            Ext.Msg.show({
                                                title:'Operazione non permessa',
                                                msg: "La richiesta è stata cancellata: non può essere erogata.",
                                                buttons: Ext.Msg.Ok,
                                            });
                                            return;
                                        }
                                        else if (record.get('stato') === "Erogato"){
                                            Ext.Msg.show({
                                                title:'Operazione non permessa',
                                                msg: "Il servizio è stato erogato, non sono permesse modifiche",
                                                buttons: Ext.Msg.Ok,
                                            });
                                            return;
                                        }

                                        record.set('stato',"Erogato");
                                    },
                                    icon: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACeElEQVRYR91XQW7TQBR9z0kFrMgGlOxyg3hO0HCChhO0nIBkCQ4iEgksSU9AcoKUExBOYPcGsLIpG7OiUht/NE4muKmNJnKiqszKsv7Mf/P+/2/+JwA0hv4ZyCP9vY8lkBeRpyZ5Z7P+zm/T4Zd9OM6eGXou7wcAEZmC+LYDRtoED8051gxIIs+iN2peFkB95A8Ivr2/AOof/CYTfgTQsWJDEAOchP1WT9uXZqAx8scAX1o5zxiZEJYHMPS7YMrAVusaon56KigNYCVQXSFqtggSIrh4rc52EgJbp0V2pRmoDfzagwPnmCJWSUgiXlCmO2Ogcdc5cOdVoEPwqIrJNklIIAg91f0/klDf4snIdytwrPoEAWI6yefolUofstJVUB/5JwQ/bVWOglgqojSI0gD2mYQ6vx5WnaOo35re6oiMli/px5zgY2sWRM5/X6MdD1ScZUAgvyJPpYqqz60umXW1r0IA1k4LDA0AEfm+IDrp+6DbP3IGoiaQr5Gn2vsFIOgYRrLCphm5vEJTM1UKwCpPDiWR3mYXpanWt04rYuhPSB4bshaU50aydwEg7RkEmFxeSU/fyjhKxewg7bjdv5GSUyNW+l8pACu1nINspQ4EcUIOfnit02USc0aguXYuch72VQZMSQCZrPY3cjGAoKmTzfzXcYcD1wiV+Z83mASS9ncWizLVE8+m6OTtLJqOyk1GN5VPa8Z6DsiC0LNG1FcnecC4EoZNCi2uvzYJQs9VuotGguCWcGXEKRfA6uHQ6HIR2iBJiLEuq6fv/U5FOMvGfQG0TTkWArBxYmtzo+ZFemFfjf+1N3ditXWWZ2dKU4CgKO7ZfX8A9MAi6cIss+8AAAAASUVORK5CYII=',
                                    tooltip: 'Imposta la richiesta come erogata'
                                }
                            ]
                        }
                    ],
                    dockedItems: [
                        {
                            xtype: 'pagingtoolbar',
                            dock: 'bottom',
                            width: 360,
                            displayInfo: true,
                            store: 'storeRichiesteServizi'
                        }
                    ],
                    plugins: [
                        {
                            ptype: 'cellediting'
                        }
                    ],
                    features: [
                        {
                            ftype: 'grouping',
                            showSummaryRow: true,
                            groupHeaderTpl: [
                                '',
                                '',
                                '<tpl if="name==\'Erogato\'" ><span style="color:#0277BD;"><b>Ci sono {rows.length} richieste erogate</b><br></span></tpl>   ',
                                '<tpl if="name==\'Nessuno\'" ><span style="color:#795548;"><b>Ci sono {rows.length} richieste in attesa di approvazione</b><br></span></tpl>',
                                '<tpl if="name==\'Non approvato\'" ><span style="color:#cf4c35;"><b>Ci sono {rows.length} richieste non approvate</b><br></span></tpl>',
                                '<tpl if="name==\'Approvato\'" ><span style="color:#73b51e;"><b>Ci sono {rows.length} richieste approvate</b><br></span></tpl>',
                                '<tpl if="name==\'In lavorazione\'" ><span style="color:#AFB42B;"><b>Ci sono {rows.length} richieste in lavorazione</b><br></span></tpl>',
                                '',
                                ''
                            ]
                        }
                    ]
                }
            ]
        },
        {
            xtype: 'panel',
            region: 'west',
            padding: 1,
            width: 310,
            bodyPadding: 10,
            collapsed: false,
            collapsible: true,
            title: 'Richiesta nuovo servizio',
            items: [
                {
                    xtype: 'combobox',
                    id: 'filiale',
                    fieldLabel: 'Divisione',
                    displayField: 'nome',
                    forceSelection: true,
                    store: 'storeFiliali',
                    valueField: 'nome',
                    listeners: {
                        select: {
                            fn: 'onFilialeSelect',
                            scope: 'controller'
                        }
                    }
                },
                {
                    xtype: 'combobox',
                    id: 'comboTipologia1',
                    fieldLabel: 'Tipologia',
                    value: 'Canone',
                    displayField: 'descrizione',
                    forceSelection: true,
                    queryMode: 'local',
                    store: [
                        'Canone',
                        'Modulo',
                        'Richiesta',
                        'Trasporto',
                        'Extra Contratto'
                    ],
                    valueField: 'descrizione',
                    listeners: {
                        select: {
                            fn: 'onServizioCombo1Select',
                            scope: 'controller'
                        }
                    }
                },
                {
                    xtype: 'combobox',
                    id: 'lotto1',
                    fieldLabel: 'Lotto',
                    forceSelection: true
                },
                {
                    xtype: 'combobox',
                    id: 'produzione1',
                    fieldLabel: 'Produzione',
                    displayField: 'matricola',
                    forceSelection: true,
                    store: 'storeProduzioni',
                    valueField: 'matricola'
                },
                {
                    xtype: 'combobox',
                    id: 'matricola1',
                    fieldLabel: 'Matricola',
                    forceSelection: true
                },
                {
                    xtype: 'textfield',
                    id: 'matricola2',
                    fieldLabel: 'UORG'
                },
                {
                    xtype: 'combobox',
                    id: 'servizioCombo1',
                    fieldLabel: 'Servizio',
                    displayField: 'descrizione',
                    forceSelection: true,
                    store: 'storeServizi',
                    valueField: 'descrizione',
                    listeners: {
                        select: {
                            fn: 'onServizioComboSelect',
                            scope: 'controller'
                        }
                    }
                },
                {
                    xtype: 'combobox',
                    id: 'codiciCombo1',
                    fieldLabel: 'Voce',
                    displayField: 'codice',
                    forceSelection: true,
                    store: 'storeServizi',
                    valueField: 'descrizione',
                    listeners: {
                        select: 'onCodiciComboSelect'
                    }
                },
                {
                    xtype: 'combobox',
                    id: 'luogo1',
                    fieldLabel: 'Luogo',
                    displayField: 'descrizione',
                    forceSelection: true,
                    store: 'storeLuoghi',
                    valueField: 'descrizione'
                },
                {
                    xtype: 'datefield',
                    id: 'dataRichiesta1',
                    fieldLabel: 'Data',
                    format: 'd/m/Y'
                },
                {
                    xtype: 'timefield',
                    id: 'oraRichiesta1',
                    fieldLabel: 'Ora',
                    format: 'H:i'
                },
                {
                    xtype: 'textfield',
                    disabled: true,
                    id: 'oreRichiesta1',
                    fieldLabel: 'Ore'
                },
                {
                    xtype: 'datefield',
                    id: 'dataFine1',
                    fieldLabel: 'Data fine',
                    format: 'd/m/Y'
                },
                {
                    xtype: 'textareafield',
                    id: 'noteRichiesta1',
                    fieldLabel: 'Note'
                },
                {
                    xtype: 'button',
                    width: 279,
                    text: 'Richiedi Servizio',
                    listeners: {
                        click: {
                            fn: 'onRichiediServizio',
                            scope: 'controller'
                        }
                    }
                },
                {
                    xtype: 'button',
                    height: 23,
                    padding: '',
                    width: 279,
                    text: 'Annulla',
                    listeners: {
                        click: {
                            fn: 'onClear',
                            scope: 'controller'
                        }
                    }
                }
            ]
        }
    ],
    listeners: {
        afterrender: {
            fn: 'onFrmrichiestanuovoservizioAfterRender',
            scope: 'controller'
        }
    },

    onCodiciComboSelect: function(combo, record, eOpts) {
        Ext.getCmp('servizioCombo1').setValue(record);
    }

});