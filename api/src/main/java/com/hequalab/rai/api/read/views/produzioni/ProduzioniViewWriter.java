package com.hequalab.rai.api.read.views.produzioni;

/*
 * Class generated by AppWizard
 */

import org.hibernate.SessionFactory;
import com.hequalab.rai.api.read.views.AbstractViewWriter;
import com.hequalab.rai.api.write.ApiContext;
import com.hequalab.rai.dddd.EventListener;
import com.hequalab.rai.dddd.EventStream;
import com.hequalab.rai.domain.produzioni.events.ProduzioniCreated;
import com.hequalab.rai.domain.produzioni.events.ProduzioniDeleted;
import com.hequalab.rai.domain.produzioni.events.ProduzioniUpdated;



public class ProduzioniViewWriter extends AbstractViewWriter<ProduzioniView> {

	public ProduzioniViewWriter(SessionFactory sessionFactory) {
		super(sessionFactory, ProduzioniView.class, "produzioniId");
	}

	@EventListener
	public void apply(ProduzioniCreated event, EventStream<ApiContext> stream) {
		
		try {
			  Thread.sleep(1000*10);
			} catch (InterruptedException ie) {
			    //Handle exception
			}
		
		ProduzioniView u = new ProduzioniView();
		u.setProduzioniId(event.getId());
		u.setDescrizione(event.getDescrizione());
		u.setDivisione(event.getDivisione());
		u.setMatricola(event.getMatricola());
		session().save(u);
	}

	@EventListener
	public void apply(ProduzioniUpdated event, EventStream<ApiContext> stream) {
		ProduzioniView u = find(event.getId());
		u.setDescrizione(event.getDescrizione());
		u.setDivisione(event.getDivisione());
		u.setMatricola(event.getMatricola());
		session().update(u);
	}

	@EventListener
	public void apply(ProduzioniDeleted event, EventStream<ApiContext> stream) {
		session().delete(find(event.getId()));
	}

}